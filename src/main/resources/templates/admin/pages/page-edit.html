<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="admin/layout/layout">
<head>
  <title>Update Page</title>
  <style>
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    .switch input {display:none;}

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      -webkit-transition: .4s;
      transition: .4s;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      -webkit-transition: .4s;
      transition: .4s;
    }

    input:checked + .slider {
      background-color: green;
    }

    input:focus + .slider {
      box-shadow: 0 0 1px green;
    }

    input:checked + .slider:before {
      -webkit-transform: translateX(26px);
      -ms-transform: translateX(26px);
      transform: translateX(26px);
    }

    /* Rounded sliders */
    .slider.round {
      border-radius: 34px;
    }

    .slider.round:before {
      border-radius: 50%;
    }
  </style>
</head>
<body>
<div layout:fragment="content">
  <h1>Editing Page</h1>
  <form enctype="multipart/form-data" method="post" th:action="@{/admin/pages/{id}/edit(id=${pages.page_id})}" >
    <h3>Name <input type="text" name="name" placeholder="Name" class="form-control" th:value="${pages.page_name}"></h3>
    <h3>Description <input type="text" name="description" placeholder="Description" class="form-control" th:value="${pages.description}"></h3>
    <h3>Головне фото</h3>
    <div id="mainImageContainer">
      <img th:src="${pages.main_image_path != null ? '/Kino_CMS-Yura_Dmytriv/upload/' + pages.main_image_path : '/Kino_CMS-Yura_Dmytriv/static/img/download.jpg'}" id="mainImage" style="width: 100px; height: 100px;" />
      <p id="mainImageError" style="color: red;"></p>
    </div>
    <input accept=".jpeg, .jpg, .png" type="file" name="mainImageFile" class="form-control gallery-input" placeholder="Фото" id="mainImageInput" onchange="displayImageWithValidation(this, 'mainImage', 'mainImageError')">


    <h3>Галерея картинок</h3>
    <div class="gallery-row">
      <img th:src="${pages.image_path_1 != null ? '/Kino_CMS-Yura_Dmytriv/upload/' + pages.image_path_1 : '/Kino_CMS-Yura_Dmytriv/static/img/download.jpg'}" id="galleryImage1" style="width: 100px; height: 100px;" />
      <p id="error1" style="color: red;"></p>
      <input accept=".jpeg, .jpg, .png" type="file" name="gallery_photo_1" class="form-control gallery-input" placeholder="Фото 1" onchange="displayImageWithValidation(this, 'galleryImage1', 'error1')">

      <img th:src="${pages.image_path_2 != null ? '/Kino_CMS-Yura_Dmytriv/upload/' + pages.image_path_2 : '/Kino_CMS-Yura_Dmytriv/static/img/download.jpg'}" id="galleryImage2" style="width: 100px; height: 100px;" />
      <p id="error2" style="color: red;"></p>
      <input accept=".jpeg, .jpg, .png" type="file" name="gallery_photo_2" class="form-control gallery-input" placeholder="Фото 2" onchange="displayImageWithValidation(this, 'galleryImage2', 'error2')">

      <img th:src="${pages.image_path_3 != null ? '/Kino_CMS-Yura_Dmytriv/upload/' + pages.image_path_3 : '/Kino_CMS-Yura_Dmytriv/static/img/download.jpg'}" id="galleryImage3" style="width: 100px; height: 100px;" />
      <p id="error3" style="color: red;"></p>
      <input accept=".jpeg, .jpg, .png" type="file" name="gallery_photo_3" class="form-control gallery-input" placeholder="Фото 3" onchange="displayImageWithValidation(this, 'galleryImage3', 'error3')">

      <img th:src="${pages.image_path_4 != null ? '/Kino_CMS-Yura_Dmytriv/upload/' + pages.image_path_4 : '/Kino_CMS-Yura_Dmytriv/static/img/download.jpg'}" id="galleryImage4" style="width: 100px; height: 100px;" />
      <p id="error4" style="color: red;"></p>
      <input accept=".jpeg, .jpg, .png" type="file" name="gallery_photo_4" class="form-control gallery-input" placeholder="Фото 4" onchange="displayImageWithValidation(this, 'galleryImage4', 'error4')">

      <img th:src="${pages.image_path_5 != null ? '/Kino_CMS-Yura_Dmytriv/upload/' + pages.image_path_5 : '/Kino_CMS-Yura_Dmytriv/static/img/download.jpg'}" id="galleryImage5" style="width: 100px; height: 100px;" />
      <p id="error5" style="color: red;"></p>
      <input accept=".jpeg, .jpg, .png" type="file" name="gallery_photo_5" class="form-control gallery-input" placeholder="Фото 5" onchange="displayImageWithValidation(this, 'galleryImage5', 'error5')">


      <!-- Додайте аналогічний код для інших полів галереї -->
    </div>

    <div id="data"
         th:data-image="${'/Kino_CMS-Yura_Dmytriv/upload/' + pages.main_image_path}"
         th:data-image1="${'/Kino_CMS-Yura_Dmytriv/upload/' + pages.image_path_1}"
         th:data-image2="${'/Kino_CMS-Yura_Dmytriv/upload/' + pages.image_path_2}"
         th:data-image3="${'/Kino_CMS-Yura_Dmytriv/upload/' + pages.image_path_3}"
         th:data-image4="${'/Kino_CMS-Yura_Dmytriv/upload/' + pages.image_path_4}"
         th:data-image5="${'/Kino_CMS-Yura_Dmytriv/upload/' + pages.image_path_5}">
    </div>


    <script th:inline="javascript">
      var dataElement = document.getElementById("data");

      var previousImageUrls = {
        'galleryImage1': dataElement.getAttribute("data-image1"),
        'galleryImage2': dataElement.getAttribute("data-image2"),
        'galleryImage3': dataElement.getAttribute("data-image3"),
        'galleryImage4': dataElement.getAttribute("data-image4"),
        'galleryImage5': dataElement.getAttribute("data-image5"),
        // Додайте сюди інші URL попередніх фотографій
      };

      var previousMainImageUrl = dataElement.getAttribute("data-image");


      function displayImageWithValidation(input, imgId, errorMsgId) {
        var allowedExtensions = /(\.jpg|\.jpeg|\.png)$/i;
        var file = input.files[0];
        var thumbnailContainer = document.getElementById(imgId);
        var errorMessage = document.getElementById(errorMsgId);

        // Перевірити розширення файлу
        if (!allowedExtensions.exec(file.name)) {
          errorMessage.textContent = 'Дозволені лише файли з розширеннями .jpg, .jpeg та .png';
          input.value = ''; // Очистити інпут файлу
          thumbnailContainer.src = previousImageUrls[imgId] || previousMainImageUrl || '/Kino_CMS-Yura_Dmytriv/static/img/download.jpg'; // Відновити попередню фотографію
          return false;
        }

        errorMessage.textContent = ''; // Очистити повідомлення про помилку

        thumbnailContainer.src = ''; // Очистити попередню мініатюру

        if (file) {
          var reader = new FileReader();
          reader.onload = function (e) {
            thumbnailContainer.src = e.target.result;
          };
          reader.readAsDataURL(file);
        } else {
          thumbnailContainer.src = previousImageUrls[imgId] || previousMainImageUrl || '/Kino_CMS-Yura_Dmytriv/static/img/download.jpg'; // Відновити попередню фотографію у разі відсутності нового файлу
        }
      }
    </script>

    <h3>Статус</h3>
    <label class="switch">
      <input name="status" type="checkbox"
             th:checked="${pages.status == 'on'}"
             th:value="on">
      <span class="slider round"></span>
    </label>

    <h3>Seo block</h3>
    <h3>URL<input type="text" name="url" placeholder="URL" class="form-control" th:value="${pages.seo_url}"></h3>
    <h3>Title<input type="text" name="title" placeholder="Title" class="form-control" th:value="${pages.seo_title}"></h3>
    <h3>Keywords<input type="text" name="keywords" placeholder="Keywords" class="form-control" th:value="${pages.seo_keywords}"></h3>
    <h3>Description<input type="text" name="description_seo" placeholder="Description" class="form-control" th:value="${pages.seo_description}"></h3>
    <button type="submit" class="btn btn-success">Save</button>
  </form>
</div>
</body>
</html>